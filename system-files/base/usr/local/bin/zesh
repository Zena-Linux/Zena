#!/bin/sh

DEFAULT_SHELL="/bin/bash"
CONFIG="$HOME/.config/shell"
PREFERRED_SHELL=""

if [ -r "$CONFIG" ]; then
  PREFERRED_SHELL="$(head -n 1 "$CONFIG" | tr -d '\r')"
fi

if [ -z "$PREFERRED_SHELL" ] || [ ! -x "$PREFERRED_SHELL" ]; then
  exec "$DEFAULT_SHELL" "$@"
fi

case "$(basename "$PREFERRED_SHELL")" in
  bash|fish) LOGIN_OP="--login" ;;
  zsh|ksh|mksh|dash|sh|ash|busybox) LOGIN_OP="-l" ;;
  *)    LOGIN_OP="" ;;
esac

if [ -n "$LOGIN_OP" ]; then
  exec bash --login -c "exec \"$PREFERRED_SHELL\" \"$LOGIN_OP\""
else
  exec bash --login -c "exec \"$PREFERRED_SHELL\""
fi
